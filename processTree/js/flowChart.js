$(function(){
   var tData=[{
         "id" : "4d3ce10a714245feac48000000000000",
         "name" : "工程抢险",
         "orderIndex" : 1,
         "pid" : "-1",
         "lev" : "1",
         "status" : "0",
         "nt" : null,
         "ts" : 1501927575000,
         "addvcd" : "440000",
         "org" : "006941135",
         "children" : [
            {
               "id" : "4d3ce10a714245feac4838f400000000",
               "name" : "会商会议抢会商会议抢",
               "orderIndex" : 2,
               "pid" : "4d3ce10a714245feac48000000000000",
               "lev" : "2",
               "status" : "1",
               "nt" : null,
               "ts" : 1501927575000,
               "addvcd" : "440000",
               "org" : "006941135",
               "children" : [
                  {
                     "id" : "4d3ce10a714245feac4838f4078b0000",
                     "name" : "会商会议抢会议",
                     "orderIndex" : 4,
                     "pid" : "4d3ce10a714245feac4838f400000000",
                     "lev" : "3",
                     "status" : "0",
                     "nt" : null,
                     "ts" : 1501927576000,
                     "addvcd" : "440000",
                     "org" : "006941135",
                     "children" : [],
                     "dealTp" : "08"
                  },
                  {
                     "id" : "4d3ce10a714245feac4838f42e090000",
                     "name" : "通知",
                     "orderIndex" : 1,
                     "pid" : "4d3ce10a714245feac4838f400000000",
                     "lev" : "3",
                     "status" : "0",
                     "nt" : null,
                     "ts" : 1501927576000,
                     "addvcd" : "440000",
                     "org" : "006941135",
                     "children" : [
                        {
                           "id" : "4d3ce10a714245feac4838f42e090994",
                           "name" : "电话",
                           "orderIndex" : 4,
                           "pid" : "4d3ce10a714245feac4838f42e090000",
                           "lev" : "4",
                           "status" : "0",
                           "nt" : null,
                           "ts" : 1501927576000,
                           "addvcd" : "440000",
                           "org" : "006941135",
                           "children" : [],
                           "dealTp" : "04"
                        },
                        {
                           "id" : "4d3ce10a714245feac4838f42e091328",
                           "name" : "发文",
                           "orderIndex" : 2,
                           "pid" : "4d3ce10a714245feac4838f42e090000",
                           "lev" : "4",
                           "status" : "0",
                           "nt" : null,
                           "ts" : 1501927576000,
                           "addvcd" : "440000",
                           "org" : "006941135",
                           "children" : [],
                           "dealTp" : "02"
                        },
                        {
                           "id" : "4d3ce10a714245feac4838f42e0949cf",
                           "name" : "短信",
                           "orderIndex" : 3,
                           "pid" : "4d3ce10a714245feac4838f42e090000",
                           "lev" : "4",
                           "status" : "0",
                           "nt" : null,
                           "ts" : 1501927576000,
                           "addvcd" : "440000",
                           "org" : "006941135",
                           "children" : [],
                           "dealTp" : "03"
                        },
                        {
                           "id" : "4d3ce10a714245feac4838f42e09dfca",
                           "name" : "传真",
                           "orderIndex" : 5,
                           "pid" : "4d3ce10a714245feac4838f42e090000",
                           "lev" : "4",
                           "status" : "0",
                           "nt" : null,
                           "ts" : 1501927576000,
                           "addvcd" : "440000",
                           "org" : "006941135",
                           "children" : [],
                           "dealTp" : "05"
                        },
                        {
                           "id" : "4d3ce10a714245feac4838f42e09ee67",
                           "name" : "拟稿拟稿",
                           "orderIndex" : 1,
                           "pid" : "4d3ce10a714245feac4838f42e090000",
                           "lev" : "4",
                           "status" : "1",
                           "nt" : null,
                           "ts" : 1501927576000,
                           "addvcd" : "440000",
                           "org" : "006941135",
                           "children" : [],
                           "dealTp" : "01"
                        }
                     ],
                     "dealTp" : "00"
                  },
                  {
                     "id" : "4d3ce10a714245feac4838f468f30000",
                     "name" : "签到",
                     "orderIndex" : 3,
                     "pid" : "4d3ce10a714245feac4838f400000000",
                     "lev" : "3",
                     "status" : "1",
                     "nt" : null,
                     "ts" : 1501927576000,
                     "addvcd" : "440000",
                     "org" : "006941135",
                     "children" : [],
                     "dealTp" : "07"
                  },
                  {
                     "id" : "4d3ce10a714245feac4838f4ba790000",
                     "name" : "准备",
                     "orderIndex" : 2,
                     "pid" : "4d3ce10a714245feac4838f400000000",
                     "lev" : "3",
                     "status" : "0",
                     "nt" : null,
                     "ts" : 1501927576000,
                     "addvcd" : "440000",
                     "org" : "006941135",
                     "children" : [],
                     "dealTp" : "06"
                  },
                  {
                     "id" : "4d3ce10a714245feac4838f4cd840000",
                     "name" : "决议",
                     "orderIndex" : 5,
                     "pid" : "4d3ce10a714245feac4838f400000000",
                     "lev" : "3",
                     "status" : "0",
                     "nt" : null,
                     "ts" : 1501927576000,
                     "addvcd" : "440000",
                     "org" : "006941135",
                     "children" : [
                        {
                           "id" : "4d3ce10a714245feac4838f4cd840f00",
                           "name" : "拟稿拟稿拟",
                           "orderIndex" : 1,
                           "pid" : "4d3ce10a714245feac4838f4cd840000",
                           "lev" : "4",
                           "status" : "0",
                           "nt" : null,
                           "ts" : 1501927577000,
                           "addvcd" : "440000",
                           "org" : "006941135",
                           "children" : [],
                           "dealTp" : "01"
                        },
                        {
                           "id" : "4d3ce10a714245feac4838f4cd844b6d",
                           "name" : "电话",
                           "orderIndex" : 4,
                           "pid" : "4d3ce10a714245feac4838f4cd840000",
                           "lev" : "4",
                           "status" : "0",
                           "nt" : null,
                           "ts" : 1501927577000,
                           "addvcd" : "440000",
                           "org" : "006941135",
                           "children" : [],
                           "dealTp" : "04"
                        },
                        {
                           "id" : "4d3ce10a714245feac4838f4cd844f96",
                           "name" : "传真",
                           "orderIndex" : 5,
                           "pid" : "4d3ce10a714245feac4838f4cd840000",
                           "lev" : "4",
                           "status" : "0",
                           "nt" : null,
                           "ts" : 1501927577000,
                           "addvcd" : "440000",
                           "org" : "006941135",
                           "children" : [],
                           "dealTp" : "05"
                        },
                        {
                           "id" : "4d3ce10a714245feac4838f4cd84bca3",
                           "name" : "短信",
                           "orderIndex" : 3,
                           "pid" : "4d3ce10a714245feac4838f4cd840000",
                           "lev" : "4",
                           "status" : "0",
                           "nt" : null,
                           "ts" : 1501927577000,
                           "addvcd" : "440000",
                           "org" : "006941135",
                           "children" : [],
                           "dealTp" : "03"
                        },
                        {
                           "id" : "4d3ce10a714245feac4838f4cd84c9af",
                           "name" : "发文",
                           "orderIndex" : 2,
                           "pid" : "4d3ce10a714245feac4838f4cd840000",
                           "lev" : "4",
                           "status" : "0",
                           "nt" : null,
                           "ts" : 1501927577000,
                           "addvcd" : "440000",
                           "org" : "006941135",
                           "children" : [],
                           "dealTp" : "02"
                        }
                     ],
                     "dealTp" : "09"
                  }
               ],
               "dealTp" : "00"
            },
            {
               "id" : "4d3ce10a714245feac48698e00000000",
               "name" : "专家组",
               "orderIndex" : 3,
               "pid" : "4d3ce10a714245feac48000000000000",
               "lev" : "2",
               "status" : "0",
               "nt" : null,
               "ts" : 1501927575000,
               "addvcd" : "440000",
               "org" : "006941135",
               "children" : [
                  {
                     "id" : "4d3ce10a714245feac48698e35d50000",
                     "name" : "通知",
                     "orderIndex" : 1,
                     "pid" : "4d3ce10a714245feac48698e00000000",
                     "lev" : "3",
                     "status" : "0",
                     "nt" : null,
                     "ts" : 1501927576000,
                     "addvcd" : "440000",
                     "org" : "006941135",
                     "children" : [
                        {
                           "id" : "4d3ce10a714245feac48698e35d50b7c",
                           "name" : "拟稿",
                           "orderIndex" : 1,
                           "pid" : "4d3ce10a714245feac48698e35d50000",
                           "lev" : "4",
                           "status" : "0",
                           "nt" : null,
                           "ts" : 1501927576000,
                           "addvcd" : "440000",
                           "org" : "006941135",
                           "children" : [],
                           "dealTp" : "01"
                        },
                        {
                           "id" : "4d3ce10a714245feac48698e35d54ba7",
                           "name" : "短信",
                           "orderIndex" : 3,
                           "pid" : "4d3ce10a714245feac48698e35d50000",
                           "lev" : "4",
                           "status" : "0",
                           "nt" : null,
                           "ts" : 1501927576000,
                           "addvcd" : "440000",
                           "org" : "006941135",
                           "children" : [],
                           "dealTp" : "03"
                        },
                        {
                           "id" : "4d3ce10a714245feac48698e35d55409",
                           "name" : "发文",
                           "orderIndex" : 2,
                           "pid" : "4d3ce10a714245feac48698e35d50000",
                           "lev" : "4",
                           "status" : "0",
                           "nt" : null,
                           "ts" : 1501927576000,
                           "addvcd" : "440000",
                           "org" : "006941135",
                           "children" : [],
                           "dealTp" : "02"
                        },
                        {
                           "id" : "4d3ce10a714245feac48698e35d56931",
                           "name" : "电话",
                           "orderIndex" : 4,
                           "pid" : "4d3ce10a714245feac48698e35d50000",
                           "lev" : "4",
                           "status" : "0",
                           "nt" : null,
                           "ts" : 1501927576000,
                           "addvcd" : "440000",
                           "org" : "006941135",
                           "children" : [],
                           "dealTp" : "04"
                        },
                        {
                           "id" : "4d3ce10a714245feac48698e35d5fb3a",
                           "name" : "传真",
                           "orderIndex" : 5,
                           "pid" : "4d3ce10a714245feac48698e35d50000",
                           "lev" : "4",
                           "status" : "0",
                           "nt" : null,
                           "ts" : 1501927576000,
                           "addvcd" : "440000",
                           "org" : "006941135",
                           "children" : [],
                           "dealTp" : "05"
                        }
                     ],
                     "dealTp" : "00"
                  },
                  {
                     "id" : "4d3ce10a714245feac48698e35d50000",
                     "name" : "派出",
                     "orderIndex" : 2,
                     "pid" : "4d3ce10a714245feac48698e00000000",
                     "lev" : "3",
                     "status" : "0",
                     "nt" : null,
                     "ts" : 1501927576000,
                     "addvcd" : "440000",
                     "org" : "006941135",
                     "children" : [],
                     "dealTp" : "10"
                  },
                  {
                     "id" : "4d3ce10a714245feac48698e35d50000",
                     "name" : "撤回",
                     "orderIndex" : 3,
                     "pid" : "4d3ce10a714245feac48698e00000000",
                     "lev" : "3",
                     "status" : "0",
                     "nt" : null,
                     "ts" : 1501927576000,
                     "addvcd" : "440000",
                     "org" : "006941135",
                     "children" : [],
                     "dealTp" : "11"
                  }
               ],
               "dealTp" : "00"
            },
            {
               "id" : "4d3ce10a714245feac4876f500000000",
               "name" : "完成",
               "orderIndex" : 6,
               "pid" : "4d3ce10a714245feac48000000000000",
               "lev" : "2",
               "status" : "1",
               "nt" : null,
               "ts" : 1501927576000,
               "addvcd" : "440000",
               "org" : "006941135",
               "children" : [],
               "dealTp" : "13"
            },
            {
               "id" : "4d3ce10a714245feac48b54300000000",
               "name" : "抢险通知抢险通",
               "orderIndex" : 1,
               "pid" : "4d3ce10a714245feac48000000000000",
               "lev" : "2",
               "status" : "0",
               "nt" : null,
               "ts" : 1501927575000,
               "addvcd" : "440000",
               "org" : "006941135",
               "children" : [
                  {
                     "id" : "4d3ce10a714245feac48b54367db0000",
                     "name" : "电话",
                     "orderIndex" : 4,
                     "pid" : "4d3ce10a714245feac48b54300000000",
                     "lev" : "3",
                     "status" : "0",
                     "nt" : null,
                     "ts" : 1501927576000,
                     "addvcd" : "440000",
                     "org" : "006941135",
                     "children" : [],
                     "dealTp" : "04"
                  },
                  {
                     "id" : "4d3ce10a714245feac48b54396570000",
                     "name" : "发文",
                     "orderIndex" : 2,
                     "pid" : "4d3ce10a714245feac48b54300000000",
                     "lev" : "3",
                     "status" : "0",
                     "nt" : null,
                     "ts" : 1501927576000,
                     "addvcd" : "440000",
                     "org" : "006941135",
                     "children" : [],
                     "dealTp" : "02"
                  },
                  {
                     "id" : "4d3ce10a714245feac48b543bfc20000",
                     "name" : "传真",
                     "orderIndex" : 5,
                     "pid" : "4d3ce10a714245feac48b54300000000",
                     "lev" : "3",
                     "status" : "0",
                     "nt" : null,
                     "ts" : 1501927576000,
                     "addvcd" : "440000",
                     "org" : "006941135",
                     "children" : [],
                     "dealTp" : "05"
                  },
                  {
                     "id" : "4d3ce10a714245feac48b543c5e00000",
                     "name" : "短信",
                     "orderIndex" : 3,
                     "pid" : "4d3ce10a714245feac48b54300000000",
                     "lev" : "3",
                     "status" : "0",
                     "nt" : null,
                     "ts" : 1501927576000,
                     "addvcd" : "440000",
                     "org" : "006941135",
                     "children" : [],
                     "dealTp" : "03"
                  },
                  {
                     "id" : "4d3ce10a714245feac48b543fa550000",
                     "name" : "拟稿",
                     "orderIndex" : 1,
                     "pid" : "4d3ce10a714245feac48b54300000000",
                     "lev" : "3",
                     "status" : "0",
                     "nt" : null,
                     "ts" : 1501927576000,
                     "addvcd" : "440000",
                     "org" : "006941135",
                     "children" : [],
                     "dealTp" : "01"
                  }
               ],
               "dealTp" : "00"
            },
            {
               "id" : "4d3ce10a714245feac48c32d00000000",
               "name" : "信息收集",
               "orderIndex" : 4,
               "pid" : "4d3ce10a714245feac48000000000000",
               "lev" : "2",
               "status" : "0",
               "nt" : null,
               "ts" : 1501927575000,
               "addvcd" : "440000",
               "org" : "006941135",
               "children" : [],
               "dealTp" : "12"
            },
            {
               "id" : "4d3ce10a714245feac48cb3300000000",
               "name" : "信息报送",
               "orderIndex" : 5,
               "pid" : "4d3ce10a714245feac48000000000000",
               "lev" : "2",
               "status" : "0",
               "nt" : null,
               "ts" : 1501927576000,
               "addvcd" : "440000",
               "org" : "006941135",
               "dealTp" : "12",
               "children" : [
                  {
                     "id" : "4d3ce10a714245feac48cb333a780000",
                     "name" : "发文",
                     "orderIndex" : 2,
                     "pid" : "4d3ce10a714245feac48cb3300000000",
                     "lev" : "3",
                     "status" : "0",
                     "nt" : null,
                     "ts" : 1501927576000,
                     "addvcd" : "440000",
                     "org" : "006941135",
                     "children" : [],
                     "dealTp" : "02"
                  },
                  {
                     "id" : "4d3ce10a714245feac48cb336e670000",
                     "name" : "传真",
                     "orderIndex" : 5,
                     "pid" : "4d3ce10a714245feac48cb3300000000",
                     "lev" : "3",
                     "status" : "0",
                     "nt" : null,
                     "ts" : 1501927576000,
                     "addvcd" : "440000",
                     "org" : "006941135",
                     "children" : [],
                     "dealTp" : "05"
                  },
                  {
                     "id" : "4d3ce10a714245feac48cb3374800000",
                     "name" : "短信",
                     "orderIndex" : 3,
                     "pid" : "4d3ce10a714245feac48cb3300000000",
                     "lev" : "3",
                     "status" : "0",
                     "nt" : null,
                     "ts" : 1501927576000,
                     "addvcd" : "440000",
                     "org" : "006941135",
                     "children" : [],
                     "dealTp" : "03"
                  },
                  {
                     "id" : "4d3ce10a714245feac48cb33b9bd0000",
                     "name" : "拟稿",
                     "orderIndex" : 1,
                     "pid" : "4d3ce10a714245feac48cb3300000000",
                     "lev" : "3",
                     "status" : "0",
                     "nt" : null,
                     "ts" : 1501927576000,
                     "addvcd" : "440000",
                     "org" : "006941135",
                     "children" : [],
                     "dealTp" : "01"
                  },
                  {
                     "id" : "4d3ce10a714245feac48cb33e34b0000",
                     "name" : "电话",
                     "orderIndex" : 4,
                     "pid" : "4d3ce10a714245feac48cb3300000000",
                     "lev" : "3",
                     "status" : "0",
                     "nt" : null,
                     "ts" : 1501927576000,
                     "addvcd" : "440000",
                     "org" : "006941135",
                     "children" : [],
                     "dealTp" : "04"
                  }
               ],
               "dealTp" : "00"
            }
         ],
        "dealTp" : "00"
   }] 

   var flowChart={
       init:function(tData){
           var id = document.getElementById('flowChart');
           var oSvg=flowChart.createTag('svg',{'width':'100%','height':'100%'});
           var tHeight=0;
           var initX=45;//初始左偏移
           var initY=20;//初始上偏移
           var rYBase3=0;//下一个3级大节点（也可以说是二级节点）的y轴位置是在上一个的结束位置上累加的
           var rectH=36;//长方形高度 
           var rectBottom=10;//长方形高度底部间距
           var threeBottom=35;//第3级模块之间间距
           var vLineStart12=0;//1-2级竖线开始位置
           var vLineEnd12=0;//1-2级竖线结束位置
           var data=tData[0].children||[];
           var offsetY=Math.ceil(rectH/2);//Y轴偏移
           data=data.sort(flowChart.compare('orderIndex'));
           for(var i=0,len=data.length;i<len;i++){
               var data2=data[i].children||[];
               data2=data2.sort(flowChart.compare('orderIndex'));
               var len2=data2.length;
               var type1=data[i].status==1?'hRectActive':'hRect';
               var num=len2||1;//没有3级则保留一个节点的高度
               var vLineStart23=0;//2-3级竖线开始位置
               var vLineEnd23=0;//2-3级竖线结束位置
               var hLine23=0;//2-3级中间连线

               for(var j=0;j<len2;j++){
                 var data3=data2[j].children||[];
                 data3=data3.sort(flowChart.compare('orderIndex'));
                 var rY=rYBase3+((rectH+rectBottom)*j)+initY;
                 var type2=data2[j].status==1?'hRectActive':'hRect';
                 if(j==0){vLineStart23=rY+offsetY};
                 if(j==(len2-1)&&vLineStart12==0){//1-2级竖线开始位置
                  vLineEnd23=rY-(vLineStart23-offsetY);
                  vLineStart12=vLineStart23+vLineEnd23/2
                 };
                 if(j==(len2-1)){
                  vLineEnd23=rY-(vLineStart23-offsetY);
                  hLine23=vLineStart23+vLineEnd23/2;
                 };
                 _loopChart20(i,j,len2,type2);

                 for(var k=0,len3=data3.length;k<len3;k++){
                     var type3=data3[k].status==1?'hRectActive':'hRect';
                      _loopChart30(i,j,k,rY,type3);
                 }
                 //console.log('i:'+i+' '+num+':'+rYBase3+' rY:'+rY); 
               }
               _loopChart10(i,len,type1);
            }
            _outerChart();

            tHeight=hLine23+vLineStart12;
            id.style.height=tHeight+'px';
            id.appendChild(oSvg);

            function _outerChart(){//创建最外层图形
               var params={
                   type:'shLine',
                   id:'shLine0',
                   data:'11',
                   x1:76,
                   y1:(hLine23+vLineStart12)/2
               };
               var shLine=flowChart.cRect(params);//创建1级横短线
               oSvg.appendChild(shLine); 

               var params={
                   type:'vRect',
                   id:'vRect',
                   data:'11',
                   width:36,
                   rX:46,
                   rY:(hLine23+vLineStart12)/2,
                   tit:tData[0].name
               };
               var vRect=flowChart.cRect(params);//创建1级竖的长方形
               oSvg.appendChild(vRect);

               var params={
                   type:'vLine',
                   id:'shLine1-'+i,
                   data:'11',
                   x1:108,
                   y1:vLineStart12,
                   pHeight:(hLine23-vLineStart12)
                  };
               var vLine=flowChart.cRect(params);//创建1-2级竖线
               oSvg.appendChild(vLine);
            }

            function _loopChart10(i,len,type){//循环创建第一层图形
               //console.log(type);
               var params={
                   type:'vLine',
                   id:'vLine'+i,
                   data:'55',
                   x1:278,
                   y1:vLineStart23,
                   pHeight:vLineEnd23
               };
               var vLine=flowChart.cRect(params);//创建2-3级竖线
               oSvg.appendChild(vLine);

                  if(i==(len-1)){vLineEnd12=vLineEnd23;}

                  if(len2>0){//有第3级节点才创建2-3级横线
                     var params={
                         type:'shLine',
                         id:'hLine23-'+i,
                         data:'66',
                         x1:250,
                         y1:hLine23
                     };
                     var hLine=flowChart.cRect(params);//创建2-3级横线
                     oSvg.appendChild(hLine);
                  }else{
                     hLine23=rYBase3+threeBottom+initY-(rectBottom*2);
                  }
                  var params={
                      type:type||'hRect',
                      id:'hRect'+i,
                      data:'11',
                      rX:140,
                      rY:hLine23-offsetY,
                      tit:data[i].name
                  };
                  var hRect=flowChart.cRect(params);//创建2级长方形
                  oSvg.appendChild(hRect);

                  var params={
                      type:'shLine',
                      id:'shLine1-'+i,
                      data:'11',
                      x1:108,
                      y1:hLine23
                  };
                  var shLine=flowChart.cRect(params);//创建1-2级横短线
                  oSvg.appendChild(shLine);
                  rYBase3+=((rectH+rectBottom)*num)+threeBottom;//每循环一层3级节点都保留之前高度的基数位置
            }

            function _loopChart20(i,j,len2,type){//循环创建第二层图形
                 var params={
                      type:type||'hRect',
                      id:'hRect'+i+j,
                      data:'11',
                      rX:310,
                      rY:rY,
                      tit:data2[j].name
                 };
                 var hRect=flowChart.cRect(params);//创建3级长方形
                 oSvg.appendChild(hRect);
                 var params={
                      type:'shLine',
                      id:'line'+i+j,
                      data:'44',
                      x1:278,
                      y1:rY+offsetY
                 };
                 var line=flowChart.cRect(params);//创建2-3级短线(竖线右侧)
                 oSvg.appendChild(line);
            };

            function _loopChart30(i,j,k,rY,type){//循环创建第三层图形
                 var params={
                      type:'shLine',
                      id:'hLine34-'+i+j+k,
                      data:'66',
                      x1:420,
                      y1:rY+offsetY
                  };
                  var hLine=flowChart.cRect(params);//创建3-4级横线
                  oSvg.appendChild(hLine);
                  var params={
                      type:type||'hRect',
                      id:'hRect34-'+i+j+k,
                      data:'11',
                      width:88,
                      rX:452+(k*103),
                      rY:rY,
                      tit:data3[k].name
                  };
                  var hRect=flowChart.cRect(params);//创建2级长方形
                  oSvg.appendChild(hRect);
            };
       },
       cRect:function(settings){//创建图形
          var oG =flowChart.createTag('g',{'id':settings.id}); 
          settings.width=Number(settings.width)||112;
          settings.height=Number(settings.height)||36;
          if(settings.type=='hRect'){//长方形
            var oTit=flowChart.createTag('title',{
                'class':'tit'});
            var oRect =flowChart.createTag('rect',{
               'x':settings.rX,
               'y':settings.rY,
               'width':(settings.width-2),'height':(settings.height-2),'rx':'4','ry':'4','class':'hRect rect','data':settings.data});
            var oText =flowChart.createTag('text',{
               'x':Number(settings.rX)+Math.ceil(settings.width/2),
               'y':Number(settings.rY)+22,
               'width':(settings.width-2),'height':(settings.height-2),'class':'hRectTxt txt','data':settings.data});
            oTit.textContent = settings.tit;
            oText.textContent =flowChart.getTit(settings.tit,settings.width);
            oG.appendChild(oTit);
            oG.appendChild(oRect);
            oG.appendChild(oText);
            return oG;
          }else if(settings.type=='hRectActive'){//选中的长方形
            var oTit=flowChart.createTag('title',{
                'class':'tit'});
            var oRect =flowChart.createTag('rect',{
               'x':settings.rX,
               'y':settings.rY,
               'width':(settings.width-2),'height':(settings.height-2),'rx':'4','ry':'4','class':'hRect2 rect active','data':settings.data});
            var oText =flowChart.createTag('text',{
               'x':Number(settings.rX)+Math.ceil(settings.width/2),
               'y':Number(settings.rY)+22,
               'width':(settings.width-2),'height':(settings.height-2),'class':'hRectTxt txt','data':settings.data});
            var oImage =flowChart.createTag('image',{
               'x':settings.rX+4,
               'y':settings.rY+10,
               'href':'img/right.png',
               'width':'14','height':'13','class':'imgRight','data':settings.data});
            oTit.textContent = settings.tit;
            oText.textContent = flowChart.getTit(settings.tit,settings.width,2);
            oG.appendChild(oTit);
            oG.appendChild(oRect);
            oG.appendChild(oText);
            oG.appendChild(oImage);
            return oG;
          }else if(settings.type=='vRect'){//竖的长方形
            settings.tit=settings.tit||'';
            var len=settings.tit.length;
            if(len<=5){//小于5个字默认高度
               settings.height=112;
            }else{//大于5个字每增加一个字增加20高度
               settings.height=112+(len-5)*16
            }
            var oTit=flowChart.createTag('title',{
                'class':'tit'});
            var oRect =flowChart.createTag('rect',{
               'x':settings.rX,
               'y':settings.rY-settings.height/2,
               'width':(settings.width-2),'height':(settings.height-2),'rx':'4','ry':'4','class':'vRect','data':settings.data});
            oTit.textContent = settings.tit;
            oG.appendChild(oTit);
            oG.appendChild(oRect);
            for(var i=0;i<len;i++){
               var oText =flowChart.createTag('text',{
                  'x':Number(settings.rX)+Math.ceil(settings.width/2),//+24
                  'y':Number(settings.rY)-(len*16)/2+(i*16)+9,
                  'width':(settings.width-2),'class':'vTxt','data':settings.data});
               oText.textContent = settings.tit.slice(i,i+1); 
               oG.appendChild(oText);
            }
            return oG;
          }
          else if(settings.type=='hRectInf'){//浅黑的长方形
            var oTit=flowChart.createTag('title',{
                'class':'tit'});
            var oRect =flowChart.createTag('rect',{
               'x':settings.rX,
               'y':settings.rY,
               'width':(settings.width-2),'height':(settings.height-2),'rx':'4','ry':'4','class':'hRect3 rect','data':settings.data});
            var oText =flowChart.createTag('text',{
               'x':Number(settings.rX)+Number(settings.tX), 
               'y':Number(settings.rY)+Number(settings.tY),
               'width':(settings.width-2),'height':(settings.height-2),'class':'hRectTxt3 txt','data':settings.data});
            oTit.textContent = settings.tit;
            oText.textContent = settings.tit;
            oG.appendChild(oTit);
            oG.appendChild(oRect);
            oG.appendChild(oText);
            return oG;
          }else if(settings.type=='shLine'){//短线
            var oLine =flowChart.createTag('line',{
               'x1':settings.x1,
               'y1':settings.y1,
               'x2':Number(settings.x1)+32,
               'y2':settings.y1,
               'class':'hLine line','data':settings.data});
            oG.appendChild(oLine);
            return oG;
          }else if(settings.type=='vLine'){//竖线
            var oLine =flowChart.createTag('line',{
               'x1':settings.x1,
               'y1':settings.y1,
               'x2':settings.x1, 
               'y2':Number(settings.y1)+Number(settings.pHeight),
               'class':'vLine line','data':settings.data});
            oG.appendChild(oLine);
            return oG;
          }else if(settings.type=='hRectInf'){//提示暂时未用
            var hRect3=flowChart.cRect({
                type:'hRectInf',
                id:'hRect3',
                data:'33',
                width:62,
                rX:310,
                rY:410,
                tX:34,
                tY:22,
                tit:'派出 （2）人'
            });
            oSvg.appendChild(hRect3);
          }
       },
       getTit:function(tit,width,num){
         num=num||0;
         var len=tit.length;
         if(width>100){
            if(len>(7-num)){
              return tit.slice(0,(7-num))+'...';
            }else{
              return tit; 
            }
         }else{
            if(len>(5-num)){
               return tit.slice(0,(5-num))+'...';
            }else{
              return tit; 
            }
         }
       },
       createTag:function(tag,objAttr){//创建图形标签
          var svgNS = 'http://www.w3.org/2000/svg';
          var oTag = document.createElementNS(svgNS,tag);  
          for(var attr in objAttr){
            oTag.setAttribute(attr,objAttr[attr]);
          }  
          return oTag;   
        },
        compare:function(property){
            return function(a,b){
                var value1 = a[property];
                var value2 = b[property];
                return value1 - value2;
            }
         }
   };
   flowChart.init(tData);
   $('.rect,.txt,.imgRight').unbind('click').on('click',function(){
      alert($(this).attr('data'));
   });

   $('.rect,.txt').unbind('mouseenter').on('mouseenter',function(){
      //alert($(this).attr('data'));
   });

   $('.rect,.txt').unbind('mouseleave').on('mouseleave',function(){
      //alert($(this).attr('data'));
   });
})